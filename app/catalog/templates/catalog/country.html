{% extends "base.html" %}
{% block page_title %}Shop {{ country_name }} – ASEARA{% endblock %}

{% block page_body %}
<div class="container mt-4">

  <!-- Hero -->
  <div class="bg-light rounded-3 p-4 p-md-5 mb-4">
    <div class="d-flex align-items-center gap-3">
      <img src="https://flagcdn.com/{{ cc|lower }}.svg" alt="{{ country_name }} flag" style="height:36px">
      <div>
        <h1 class="h3 mb-1">Shop {{ country_name }}</h1>
        <div class="text-muted">Verified local suppliers • Cross-border friendly</div>
      </div>
    </div>

    <!-- Country-scoped search -->
    <form class="row g-2 mt-3" action="{{ url_for('catalog.search') }}" method="get">
      <input type="hidden" name="country" value="{{ cc }}">
      <div class="col-md-10">
        <input class="form-control form-control-lg" name="q"
               placeholder="Search products from {{ country_name }} (e.g., coffee, batik, snacks)">
      </div>
      <div class="col-md-2 d-grid">
        <button class="btn btn-primary btn-lg">Search</button>
      </div>
    </form>
  </div>

  <!-- Popular categories -->
  {% if category_counts %}
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Popular Categories</h5>
    <a class="small text-muted" href="{{ url_for('catalog.search', country=cc) }}">Browse all</a>
  </div>
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-6 g-3 mb-4">
    {% for cat, count in category_counts %}
    <div class="col">
      <a class="text-decoration-none" href="{{ url_for('catalog.country_category', country_code=cc, category=cat) }}">
        <div class="card h-100 text-center">
          <div class="card-body">
            <div class="fw-semibold">{{ cat or 'Uncategorized' }}</div>
            <div class="small text-muted">{{ count }} items</div>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Featured products -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Featured from {{ country_name }}</h5>
    <a class="small text-muted" href="{{ url_for('catalog.search', country=cc, sort='newest') }}">See more</a>
  </div>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 mb-4">
    {% if featured_products %}
      {% for p in featured_products %}
      <div class="col">
        <div class="card h-100">
          {% if p.main_image_path %}
            <img src="{{ url_for('static', filename='uploads/products/' ~ p.main_image_path) }}"
                 class="card-img-top" alt="{{ p.name }}">
          {% endif %}
          <div class="card-body">
            <h6 class="card-title text-truncate" title="{{ p.name }}">{{ p.name }}</h6>
            <div class="small text-muted">{{ p.supplier.business_name if p.supplier else '' }}</div>
          </div>
          <div class="card-footer d-flex justify-content-between align-items-center">
            <span class="fw-semibold">{{ p.currency }} {{ '%.2f'|format(p.price) }}</span>
            <a class="btn btn-sm btn-outline-primary"
               href="{{ url_for('catalog.product_detail', product_id=p.id) }}">View</a>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="col">
        <div class="alert alert-light border">No featured products yet.</div>
      </div>
    {% endif %}
  </div>

  <!-- Featured suppliers (optional) -->
  {% if suppliers %}
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Featured Suppliers</h5>
    <a class="small text-muted" href="{{ url_for('catalog.search', country=cc) }}">View all</a>
  </div>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 mb-4">
    {% for s in suppliers %}
    <div class="col">
      <div class="card h-100">
        <div class="card-body">
          <div class="fw-semibold text-truncate">{{ s.business_name or 'Supplier' }}</div>
          <div class="small text-muted">{{ s.nature_of_business or '' }}</div>
          {% if s.is_verified %}
            <span class="badge text-bg-success mt-2">Verified</span>
          {% endif %}
        </div>
        <div class="card-footer text-end">
          <a class="btn btn-sm btn-outline-secondary disabled" href="#">Supplier page</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Trust strip -->
  <div class="bg-body-tertiary rounded-3 p-3 text-center text-muted">
    Vendors in {{ country_name }} are verified by our local team. Secure checkout, cross-border shipping support.
  </div>

</div>
{% endblock %}
